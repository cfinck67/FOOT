# Makefile for the ROOT test programs.
# This Makefile shows nicely how to compile and link applications
# using the ROOT libraries on all supported platforms.
#
# Copyright (c) 2000 Rene Brun and Fons Rademakers
#

CXX           =
ObjSuf        = o
SrcSuf        = cpp
ExeSuf        =
DllSuf        = so
OutPutOpt     = -o 

ROOTCFLAGS   := $(shell root-config --cflags)
ROOTLIBS     := $(shell root-config --libs)
ROOTGLIBS    := $(shell root-config --glibs)
ARCH       = $(shell root-config --arch)

# Linux with egcs, gcc 2.9x, gcc 3.x (>= RedHat 5.2)
CXX           = g++
CXXFLAGS      = -g -Wall -fPIC
LD            = g++
LDFLAGS       = -O
SOPATH        = ../lib
SOFLAGS       = -shared -dynamiclib

ifeq ($(ARCH),macosx64)
SOFLAGS = -dynamiclib -single_module -undefined dynamic_lookup
endif

CXXFLAGS     += $(ROOTCFLAGS) -I.
LIBS          = $(ROOTLIBS) $(SYSLIBS)
GLIBS         = $(ROOTGLIBS) $(SYSLIBS)


#------------------------------------------------------------------------------
SRC   = Evento.cpp Txt2RootDict.cpp 
OBJ   = Evento.o Txt2RootDict.o
HEAD  = Evento.h 
#------------------------------------------------------------------------------

all:            Txt2Root libStruct

Txt2Root:  Txt2Root.o $(OBJ) $(HEAD)  EventStruct.h
	$(LD) $(LDFLAGS) Txt2Root.o $(OBJ) $(GLIBS) -o Txt2Root

Txt2RootDict.cpp:  $(HEAD) EventStruct.h Txt2RootLinkDef.h
		@echo "Generating dictionary $@..." 
		@$(ROOTSYS)/bin/rootcint -f Txt2RootDict.cpp -c -p $(HEAD)

Txt2Root.o:   Txt2Root.cpp $(HEAD) EventStruct.h
	    g++ -c Txt2Root.cpp $(CXXFLAGS)

Evento.o:   Evento.cpp $(HEAD) Evento.h EventStruct.h
	    g++ -c Evento.cpp $(CXXFLAGS)

libStruct: Evento.o
	$(CXX) $(SOFLAGS) -o $(SOPATH)/libEventStruct.$(DllSuf) \
		$(OBJ) $(GLIBS)
clean:
	@rm -f $(OBJ) Txt2RootDict.o core *.so Txt2RootDict.cpp Txt2Root.o Txt2Root


